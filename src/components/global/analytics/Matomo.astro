---
import { SITE } from "@/consts"
---

{ SITE.matomoURL && (
	<script
		is:inline
		define:vars={{ MATOMO_URL: SITE.matomoURL }}
		type="text/plain"
		data-category="analytics"
		data-service="Matomo Analytics"
	>
		document.addEventListener('astro:page-load', () => {
			var _paq = (window._paq = window._paq || [])
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(['setDocumentTitle', document.domain + '/' + document.title])
			_paq.push(['setDoNotTrack', true])
			_paq.push(['trackPageView'])
			_paq.push(['enableLinkTracking'])
			;(function () {
				var u = MATOMO_URL
				_paq.push(['setTrackerUrl', u + 'matomo.php'])
				_paq.push(['setSiteId', '1'])
				var d = document,
					g = d.createElement('script'),
					s = d.getElementsByTagName('script')[0]
				g.async = true
				g.src = u + 'matomo.js'
				s.parentNode.insertBefore(g, s)
			})()
		})
	</script>
)}