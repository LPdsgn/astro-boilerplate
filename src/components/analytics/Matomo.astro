---
import { SITE } from '@/site.config';
---

{
	SITE.analytics?.matomo?.url && SITE.analytics?.matomo?.siteId && (
	<script
		is:inline
		define:vars={{
			MATOMO_URL: SITE.analytics.matomo.url,
			MATOMO_SITE_ID: SITE.analytics.matomo.siteId,
		}}
		type="text/plain"
		data-category="analytics"
		data-service="Matomo Analytics"
	>
		document.addEventListener('astro:page-load', () => {
			var _paq = (window._paq = window._paq || [])
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push([
				'setDocumentTitle',
				window.location.hostname + '/' + document.title,
			])
			_paq.push(['setDoNotTrack', true])
			_paq.push(['trackPageView'])
			_paq.push(['enableLinkTracking'])
			;(function () {
				var u = MATOMO_URL
				_paq.push(['setTrackerUrl', u + 'matomo.php'])
				_paq.push(['setSiteId', MATOMO_SITE_ID])
				var d = document,
					g = d.createElement('script'),
					s = d.getElementsByTagName('script')[0]
				g.async = true
				g.src = u + 'matomo.js'
				s.parentNode.insertBefore(g, s)
			})()
		})
	</script>
)}